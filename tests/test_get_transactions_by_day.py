"""Test the get_transactions_by_day function."""

from get_transactions_by_day import main

transactions = {
    "transactions": [
        {
            "symbol": "GOOGL",
            "date": "2023-03-25",
            "cost": 100,
            "quantity": 10,
            "transaction_type": "Buy",
            "transaction_cost": 0.5,
            "currency": "USD",
            "domain": "google.com",
            "userid": "2e43b4a359f8d5bb81550495b114e9e3",
            "id": "9a7b12ca-bd93-44f0-9e20-a061ce270f9b",
        },
        {
            "symbol": "aapl",
            "date": "2023-03-27",
            "cost": 100,
            "quantity": 5,
            "transaction_type": "Buy",
            "transaction_cost": 0.5,
            "currency": "USD",
            "domain": "apple.com",
            "userid": "2e43b4a359f8d5bb81550495b114e9e3",
            "id": "9a7bca-bd93-4430-9e20-a061ce270fdd",
        },
        {
            "symbol": "MSFT",
            "date": "2023-03-28",
            "cost": 250,
            "quantity": 2,
            "transaction_type": "Buy",
            "transaction_cost": 0.5,
            "currency": "USD",
            "domain": "microsoft.com",
            "userid": "2e43b4a359f8d5bb81550495b114e9e3",
            "id": "81364101-4055-4245-8f97-17d0820a7e70",
        },
        {
            "symbol": "AMD",
            "date": "2023-03-28",
            "cost": 100,
            "quantity": 1,
            "transaction_type": "Buy",
            "transaction_cost": 0.5,
            "currency": "USD",
            "domain": "amd.com",
            "userid": "2e43b4a359f8d5bb81550495b114e9e3",
            "id": "9a7b12ca-bd93-4430-9e20-a061ce270f9b",
        },
        {
            "symbol": "GOOGL",
            "date": "2023-03-28",
            "cost": 100,
            "quantity": 5,
            "transaction_type": "Sell",
            "transaction_cost": 0.5,
            "currency": "USD",
            "domain": "google.com",
            "userid": "2e43b4a359f8d5bb81550495b114e9e3",
            "id": "9a7b12ca-bd93-44z0-9e20-a061ce270f9b",
        },
        {
            "symbol": "aapl",
            "date": "2023-03-28",
            "cost": 100,
            "quantity": 3,
            "transaction_type": "Sell",
            "transaction_cost": 0.5,
            "currency": "USD",
            "domain": "apple.com",
            "userid": "2e43b4a359f8d5bb81550495b114e9e3",
            "id": "9a7b12ca-bd93-9e20-a061ce270fdd",
        },
        {
            "symbol": "MSFT",
            "date": "2023-03-29",
            "cost": 270,
            "quantity": 1,
            "transaction_type": "Sell",
            "transaction_cost": 0.5,
            "currency": "USD",
            "domain": "microsoft.com",
            "userid": "2e43b4a359f8d5bb81550495b114e9e3",
            "id": "fddc9b9a-9b9a-4b9a-9b9a-9b9a9b9a9b9a",
        },
        {
            "symbol": "GOOGL",
            "date": "2023-03-29",
            "cost": 100,
            "quantity": 5,
            "transaction_type": "Sell",
            "transaction_cost": 0.5,
            "currency": "USD",
            "domain": "google.com",
            "userid": "2e43b4a359f8d5bb81550495b114e9e3",
            "id": "9a7b12ca-bd93-443x-9e20-a061ce270f9b",
        },
        {
            "symbol": "aapl",
            "date": "2023-03-29",
            "cost": 100,
            "quantity": 2,
            "transaction_type": "Buy",
            "transaction_cost": 0.5,
            "currency": "USD",
            "domain": "apple.com",
            "userid": "2e43b4a359f8d5bb81550495b114e9e3",
            "id": "9a7b12ca-b3-4430-9e20-a061ce270fdd",
        },
        {
            "symbol": "VWRL.AMS",
            "date": "2023-03-29",
            "cost": 100,
            "quantity": 2,
            "transaction_type": "Buy",
            "transaction_cost": 0.5,
            "currency": "EUR",
            "domain": "vanguard.com",
            "userid": "2e43b4a359f8d5bb81550495b114e9e3",
            "id": "9a7b12ca-4430-9e20-a061ce270fdd",
        },
    ],
    "invested": [
        {
            "date": "2023-03-26",
            "amount": 1000,
            "transaction_type": "Deposit",
            "userid": "2e43b4a359f8d5bb81550495b114e9e3",
            "id": "b25aeb95-175c-48c3-96ef-39428fd16792",
        },
        {
            "date": "2023-03-27",
            "amount": 1000,
            "transaction_type": "Deposit",
            "userid": "Deposit",
            "id": "b25aeasdfasdf175c-48c3-96ef-39428fd16792",
        },
        {
            "date": "2023-03-28",
            "amount": 1000,
            "transaction_type": "Withdrawal",
            "userid": "2e43b4a359f8d5bb81550495b114e9e3",
            "id": "b25aeb95-175c-48c6ef-39428fd16792",
        },
    ],
    "daterange": ["2023-03-27", "2023-03-28", "2023-03-29"],
    "symbols": ["GOOGL", "aapl", "MSFT", "AMD"],
}

forex_data = {
    "USD": {
        "Meta Data": {
            "1. Information": "Forex Daily Prices (open, high, low, close)",
            "2. From Symbol": "USD",
            "3. To Symbol": "EUR",
            "4. Output Size": "Full size",
            "5. Last Refreshed": "2023-03-29 20:10:00",
            "6. Time Zone": "UTC",
        },
        "Time Series FX (Daily)": {
            "2023-03-29": {
                "1. open": "0.92220",
                "2. high": "0.92410",
                "3. low": "0.91970",
                "4. close": "0.92180",
            },
            "2023-03-28": {
                "1. open": "0.92580",
                "2. high": "0.92590",
                "3. low": "0.92140",
                "4. close": "0.92210",
            },
            "2023-03-27": {
                "1. open": "0.92840",
                "2. high": "0.93040",
                "3. low": "0.92530",
                "4. close": "0.92590",
            },
            "2023-03-24": {
                "1. open": "0.92290",
                "2. high": "0.93270",
                "3. low": "0.92230",
                "4. close": "0.92900",
            },
            "2023-03-23": {
                "1. open": "0.92060",
                "2. high": "0.92330",
                "3. low": "0.91480",
                "4. close": "0.92280",
            },
            "2023-03-22": {
                "1. open": "0.92840",
                "2. high": "0.92920",
                "3. low": "0.91680",
                "4. close": "0.92060",
            },
            "2023-03-21": {
                "1. open": "0.93230",
                "2. high": "0.93400",
                "3. low": "0.92690",
                "4. close": "0.92840",
            },
            "2023-03-20": {
                "1. open": "0.93580",
                "2. high": "0.94020",
                "3. low": "0.93170",
                "4. close": "0.93250",
            },
            "2023-03-17": {
                "1. open": "0.94190",
                "2. high": "0.94220",
                "3. low": "0.93570",
                "4. close": "0.93710",
            },
            "2023-03-16": {
                "1. open": "0.94500",
                "2. high": "0.94710",
                "3. low": "0.94010",
                "4. close": "0.94190",
            },
            "2023-03-15": {
                "1. open": "0.93150",
                "2. high": "0.95040",
                "3. low": "0.92920",
                "4. close": "0.94500",
            },
            "2023-03-14": {
                "1. open": "0.93190",
                "2. high": "0.93610",
                "3. low": "0.93010",
                "4. close": "0.93170",
            },
            "2023-03-13": {
                "1. open": "0.93480",
                "2. high": "0.93850",
                "3. low": "0.93010",
                "4. close": "0.93190",
            },
            "2023-03-10": {
                "1. open": "0.94490",
                "2. high": "0.94540",
                "3. low": "0.93450",
                "4. close": "0.93960",
            },
            "2023-03-09": {
                "1. open": "0.94780",
                "2. high": "0.94860",
                "3. low": "0.94390",
                "4. close": "0.94470",
            },
            "2023-03-08": {
                "1. open": "0.94830",
                "2. high": "0.94980",
                "3. low": "0.94560",
                "4. close": "0.94820",
            },
            "2023-03-07": {
                "1. open": "0.93650",
                "2. high": "0.94790",
                "3. low": "0.93490",
                "4. close": "0.94770",
            },
            "2023-03-06": {
                "1. open": "0.94070",
                "2. high": "0.94110",
                "3. low": "0.93480",
                "4. close": "0.93590",
            },
            "2023-03-03": {
                "1. open": "0.94330",
                "2. high": "0.94400",
                "3. low": "0.93960",
                "4. close": "0.94000",
            },
            "2023-03-02": {
                "1. open": "0.93730",
                "2. high": "0.94520",
                "3. low": "0.93660",
                "4. close": "0.94340",
            },
            "2023-03-01": {
                "1. open": "0.94500",
                "2. high": "0.94620",
                "3. low": "0.93490",
                "4. close": "0.93700",
            },
            "2023-02-28": {
                "1. open": "0.94230",
                "2. high": "0.94540",
                "3. low": "0.93920",
                "4. close": "0.94530",
            },
            "2023-02-27": {
                "1. open": "0.94780",
                "2. high": "0.94910",
                "3. low": "0.94140",
                "4. close": "0.94230",
            },
        },
    }
}

invested_result = [
    {
        "date": "2023-03-27",
        "invested": 2000,
    },
    {
        "date": "2023-03-28",
        "invested": 1000,
    },
    {
        "date": "2023-03-29",
        "invested": 1000,
    },
]

stocks_held_result = {
    "realized": [
        {
            "date": "2023-03-28",
            "symbol": "GOOGL",
            "cost_per_share_buy": 10.0,
            "cost_per_share_sell": 20.0,
            "buy_price": 50.0,
            "sell_price": 100,
            "average_buy_fx_rate": 0.929,
            "average_sell_fx_rate": 0.929,
            "quantity": 5,
            "transaction_cost": 1.0,
            "currency": "USD",
        },
        {
            "date": "2023-03-28",
            "symbol": "aapl",
            "cost_per_share_buy": 20.0,
            "cost_per_share_sell": 33.333333333333336,
            "buy_price": 60.0,
            "sell_price": 100,
            "average_buy_fx_rate": 0.929,
            "average_sell_fx_rate": 0.929,
            "quantity": 3,
            "transaction_cost": 1.0,
            "currency": "USD",
        },
        {
            "date": "2023-03-29",
            "symbol": "GOOGL",
            "cost_per_share_buy": 10.0,
            "cost_per_share_sell": 20.0,
            "buy_price": 100,
            "sell_price": 200,
            "average_buy_fx_rate": 0.929,
            "average_sell_fx_rate": 0.929,
            "quantity": 10,
            "transaction_cost": 1.5,
            "currency": "USD",
        },
        {
            "date": "2023-03-29",
            "symbol": "aapl",
            "cost_per_share_buy": 20.0,
            "cost_per_share_sell": 33.333333333333336,
            "buy_price": 60.0,
            "sell_price": 100,
            "average_buy_fx_rate": 0.929,
            "average_sell_fx_rate": 0.929,
            "quantity": 3,
            "transaction_cost": 1.0,
            "currency" "": "USD",
        },
        {
            "date": "2023-03-29",
            "symbol": "MSFT",
            "cost_per_share_buy": 125.0,
            "cost_per_share_sell": 270.0,
            "buy_price": 125.0,
            "sell_price": 270,
            "average_buy_fx_rate": 0.929,
            "average_sell_fx_rate": 0.929,
            "quantity": 1,
            "transaction_cost": 1.0,
            "currency": "USD",
        },
    ],
    "unrealized": [
        {
            "date": "2023-03-27",
            "symbol": "GOOGL",
            "cost_per_share": 10.0,
            "total_cost": 100,
            "average_fx_rate": 0.929,
            "quantity": 10,
            "transaction_cost": 0.5,
            "currency": "USD",
        },
        {
            "date": "2023-03-27",
            "symbol": "aapl",
            "cost_per_share": 20.0,
            "total_cost": 100,
            "average_fx_rate": 0.929,
            "quantity": 5,
            "transaction_cost": 0.5,
            "currency": "USD",
        },
        {
            "date": "2023-03-28",
            "symbol": "GOOGL",
            "cost_per_share": 10.0,
            "total_cost": 50.0,
            "average_fx_rate": 0.929,
            "quantity": 5,
            "transaction_cost": 0.0,
            "currency": "USD",
        },
        {
            "date": "2023-03-28",
            "symbol": "aapl",
            "cost_per_share": 20.0,
            "total_cost": 40.0,
            "average_fx_rate": 0.929,
            "quantity": 2,
            "transaction_cost": 0.0,
            "currency": "USD",
        },
        {
            "date": "2023-03-28",
            "symbol": "MSFT",
            "cost_per_share": 125.0,
            "total_cost": 250,
            "average_fx_rate": 0.929,
            "quantity": 2,
            "transaction_cost": 0.5,
            "currency": "USD",
        },
        {
            "date": "2023-03-28",
            "symbol": "AMD",
            "cost_per_share": 100.0,
            "total_cost": 100,
            "average_fx_rate": 0.929,
            "quantity": 1,
            "transaction_cost": 0.5,
            "currency": "USD",
        },
        {
            "date": "2023-03-29",
            "symbol": "aapl",
            "cost_per_share": 35.0,
            "total_cost": 140.0,
            "average_fx_rate": 0.929,
            "quantity": 4,
            "transaction_cost": 0.5,
            "currency": "USD",
        },
        {
            "date": "2023-03-29",
            "symbol": "MSFT",
            "cost_per_share": 125.0,
            "total_cost": 125.0,
            "average_fx_rate": 0.929,
            "quantity": 1,
            "transaction_cost": 0.0,
            "currency": "USD",
        },
        {
            "date": "2023-03-29",
            "symbol": "AMD",
            "cost_per_share": 100.0,
            "total_cost": 100,
            "average_fx_rate": 0.929,
            "quantity": 1,
            "transaction_cost": 0.5,
            "currency": "USD",
        },
        {
            "date": "2023-03-29",
            "symbol": "VWRL.AMS",
            "cost_per_share": 50.0,
            "total_cost": 100,
            "average_fx_rate": 1.0,
            "quantity": 2,
            "transaction_cost": 0.5,
            "currency": "EUR",
        },
    ],
}


def test_main_function():
    """Test main function."""

    payload = [transactions, forex_data]

    result = main(payload)

    # check for key stock_held and invested in result
    assert "stock_held" in result
    assert "invested" in result

    for d in result["invested"]:
        d.pop("id")
    assert result["invested"] == invested_result
    assert result["stock_held"] == stocks_held_result
