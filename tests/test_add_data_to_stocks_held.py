"""Test add data to stocks held."""
from add_data_to_stocks_held import main

mock_stock_data = {
    "GOOGL": {
        "Meta Data": {
            "1. Information": "Daily Time Series with Splits and Dividend Events",
            "2. Symbol": "GOOGL",
            "3. Last Refreshed": "2023-03-29",
            "4. Output Size": "Full size",
            "5. Time Zone": "US/Eastern",
        },
        "Time Series (Daily)": {
            "2023-03-29": {
                "1. open": "102.28",
                "2. high": "102.49",
                "3. low": "100.65",
                "4. close": "101.39",
                "5. adjusted close": "101.39",
                "6. volume": "28779572",
                "7. dividend amount": "0.0000",
                "8. split coefficient": "1.0",
            },
            "2023-03-28": {
                "1. open": "102.44",
                "2. high": "102.45",
                "3. low": "99.74",
                "4. close": "101.03",
                "5. adjusted close": "101.03",
                "6. volume": "32057865",
                "7. dividend amount": "0.0000",
                "8. split coefficient": "1.0",
            },
            "2023-03-27": {
                "1. open": "104.615",
                "2. high": "104.76",
                "3. low": "101.9273",
                "4. close": "102.46",
                "5. adjusted close": "102.46",
                "6. volume": "31120864",
                "7. dividend amount": "0.0000",
                "8. split coefficient": "1.0",
            },
            "2023-03-24": {
                "1. open": "104.99",
                "2. high": "105.49",
                "3. low": "103.84",
                "4. close": "105.44",
                "5. adjusted close": "105.44",
                "6. volume": "30411043",
                "7. dividend amount": "0.0000",
                "8. split coefficient": "1.0",
            },
            "2023-03-23": {
                "1. open": "105.06",
                "2. high": "106.3",
                "3. low": "104.46",
                "4. close": "105.6",
                "5. adjusted close": "105.6",
                "6. volume": "40797769",
                "7. dividend amount": "0.0000",
                "8. split coefficient": "1.0",
            },
            "2023-03-22": {
                "1. open": "104.27",
                "2. high": "106.59",
                "3. low": "103.33",
                "4. close": "103.37",
                "5. adjusted close": "103.37",
                "6. volume": "43427419",
                "7. dividend amount": "0.0000",
                "8. split coefficient": "1.0",
            },
        },
    },
    "aapl": {
        "Meta Data": {
            "1. Information": "Daily Time Series with Splits and Dividend Events",
            "2. Symbol": "aapl",
            "3. Last Refreshed": "2023-03-29",
            "4. Output Size": "Full size",
            "5. Time Zone": "US/Eastern",
        },
        "Time Series (Daily)": {
            "2023-03-29": {
                "1. open": "159.37",
                "2. high": "161.05",
                "3. low": "159.35",
                "4. close": "160.77",
                "5. adjusted close": "160.77",
                "6. volume": "51305691",
                "7. dividend amount": "0.0000",
                "8. split coefficient": "1.0",
            },
            "2023-03-28": {
                "1. open": "157.97",
                "2. high": "158.49",
                "3. low": "155.98",
                "4. close": "157.65",
                "5. adjusted close": "157.65",
                "6. volume": "45992152",
                "7. dividend amount": "0.0000",
                "8. split coefficient": "1.0",
            },
            "2023-03-27": {
                "1. open": "159.94",
                "2. high": "160.77",
                "3. low": "157.87",
                "4. close": "158.28",
                "5. adjusted close": "158.28",
                "6. volume": "52390266",
                "7. dividend amount": "0.0000",
                "8. split coefficient": "1.0",
            },
            "2023-03-24": {
                "1. open": "158.86",
                "2. high": "160.34",
                "3. low": "157.85",
                "4. close": "160.25",
                "5. adjusted close": "160.25",
                "6. volume": "59256343",
                "7. dividend amount": "0.0000",
                "8. split coefficient": "1.0",
            },
            "2023-03-23": {
                "1. open": "158.83",
                "2. high": "161.5501",
                "3. low": "157.68",
                "4. close": "158.93",
                "5. adjusted close": "158.93",
                "6. volume": "67622060",
                "7. dividend amount": "0.0000",
                "8. split coefficient": "1.0",
            },
            "2023-03-22": {
                "1. open": "159.3",
                "2. high": "162.14",
                "3. low": "157.81",
                "4. close": "157.83",
                "5. adjusted close": "157.83",
                "6. volume": "75701811",
                "7. dividend amount": "0.0000",
                "8. split coefficient": "1.0",
            },
        },
    },
    "MSFT": {
        "Meta Data": {
            "1. Information": "Daily Time Series with Splits and Dividend Events",
            "2. Symbol": "MSFT",
            "3. Last Refreshed": "2023-03-29",
            "4. Output Size": "Full size",
            "5. Time Zone": "US/Eastern",
        },
        "Time Series (Daily)": {
            "2023-03-29": {
                "1. open": "278.96",
                "2. high": "281.1398",
                "3. low": "278.41",
                "4. close": "280.51",
                "5. adjusted close": "280.51",
                "6. volume": "25087032",
                "7. dividend amount": "0.0000",
                "8. split coefficient": "1.0",
            },
            "2023-03-28": {
                "1. open": "275.79",
                "2. high": "276.14",
                "3. low": "272.0451",
                "4. close": "275.23",
                "5. adjusted close": "275.23",
                "6. volume": "21878647",
                "7. dividend amount": "0.0000",
                "8. split coefficient": "1.0",
            },
            "2023-03-27": {
                "1. open": "280.5",
                "2. high": "281.4589",
                "3. low": "275.52",
                "4. close": "276.38",
                "5. adjusted close": "276.38",
                "6. volume": "26840212",
                "7. dividend amount": "0.0000",
                "8. split coefficient": "1.0",
            },
            "2023-03-24": {
                "1. open": "277.24",
                "2. high": "280.63",
                "3. low": "275.28",
                "4. close": "280.57",
                "5. adjusted close": "280.57",
                "6. volume": "28199962",
                "7. dividend amount": "0.0000",
                "8. split coefficient": "1.0",
            },
            "2023-03-23": {
                "1. open": "277.94",
                "2. high": "281.06",
                "3. low": "275.2",
                "4. close": "277.66",
                "5. adjusted close": "277.66",
                "6. volume": "36610879",
                "7. dividend amount": "0.0000",
                "8. split coefficient": "1.0",
            },
            "2023-03-22": {
                "1. open": "273.4",
                "2. high": "281.04",
                "3. low": "272.18",
                "4. close": "272.29",
                "5. adjusted close": "272.29",
                "6. volume": "34873330",
                "7. dividend amount": "0.0000",
                "8. split coefficient": "1.0",
            },
        },
    },
    "AMD": {
        "Meta Data": {
            "1. Information": "Daily Time Series with Splits and Dividend Events",
            "2. Symbol": "AMD",
            "3. Last Refreshed": "2023-03-29",
            "4. Output Size": "Full size",
            "5. Time Zone": "US/Eastern",
        },
        "Time Series (Daily)": {
            "2023-03-29": {
                "1. open": "96.07",
                "2. high": "96.91",
                "3. low": "94.87",
                "4. close": "96.09",
                "5. adjusted close": "96.09",
                "6. volume": "55325974",
                "7. dividend amount": "0.0000",
                "8. split coefficient": "1.0",
            },
            "2023-03-28": {
                "1. open": "96.77",
                "2. high": "96.94",
                "3. low": "92.87",
                "4. close": "94.56",
                "5. adjusted close": "94.56",
                "6. volume": "59150100",
                "7. dividend amount": "0.0000",
                "8. split coefficient": "1.0",
            },
            "2023-03-27": {
                "1. open": "98.02",
                "2. high": "98.93",
                "3. low": "95.425",
                "4. close": "96.61",
                "5. adjusted close": "96.61",
                "6. volume": "57461354",
                "7. dividend amount": "0.0000",
                "8. split coefficient": "1.0",
            },
            "2023-03-24": {
                "1. open": "99.18",
                "2. high": "99.52",
                "3. low": "96.74",
                "4. close": "97.95",
                "5. adjusted close": "97.95",
                "6. volume": "64743698",
                "7. dividend amount": "0.0000",
                "8. split coefficient": "1.0",
            },
            "2023-03-23": {
                "1. open": "100.05",
                "2. high": "102.43",
                "3. low": "98.671",
                "4. close": "100.28",
                "5. adjusted close": "100.28",
                "6. volume": "84088899",
                "7. dividend amount": "0.0000",
                "8. split coefficient": "1.0",
            },
            "2023-03-22": {
                "1. open": "95.65",
                "2. high": "101.7",
                "3. low": "95.64",
                "4. close": "97.58",
                "5. adjusted close": "97.58",
                "6. volume": "110816317",
                "7. dividend amount": "0.0000",
                "8. split coefficient": "1.0",
            },
        },
    },
    "VWRL.AMS": {
        "Meta Data": {
            "1. Information": "Daily Time Series with Splits and Dividend Events",
            "2. Symbol": "VWRL.AMS",
            "3. Last Refreshed": "2023-03-29",
            "4. Output Size": "Full size",
            "5. Time Zone": "US/Eastern",
        },
        "Time Series (Daily)": {
            "2023-03-29": {
                "1. open": "95.77",
                "2. high": "96.0",
                "3. low": "95.59",
                "4. close": "95.98",
                "5. adjusted close": "95.98",
                "6. volume": "29176",
                "7. dividend amount": "0.0000",
                "8. split coefficient": "1.0",
            },
            "2023-03-28": {
                "1. open": "95.61",
                "2. high": "95.76",
                "3. low": "94.86",
                "4. close": "95.03",
                "5. adjusted close": "95.03",
                "6. volume": "11606",
                "7. dividend amount": "0.0000",
                "8. split coefficient": "1.0",
            },
            "2023-03-27": {
                "1. open": "95.78",
                "2. high": "95.86",
                "3. low": "95.22",
                "4. close": "95.36",
                "5. adjusted close": "95.36",
                "6. volume": "22778",
                "7. dividend amount": "0.0000",
                "8. split coefficient": "1.0",
            },
            "2023-03-24": {
                "1. open": "94.83",
                "2. high": "95.03",
                "3. low": "94.25",
                "4. close": "94.79",
                "5. adjusted close": "94.79",
                "6. volume": "40375",
                "7. dividend amount": "0.0000",
                "8. split coefficient": "1.0",
            },
            "2023-03-23": {
                "1. open": "94.5",
                "2. high": "95.36",
                "3. low": "94.24",
                "4. close": "95.01",
                "5. adjusted close": "95.01",
                "6. volume": "37496",
                "7. dividend amount": "0.0000",
                "8. split coefficient": "1.0",
            },
            "2023-03-22": {
                "1. open": "95.61",
                "2. high": "95.95",
                "3. low": "95.49",
                "4. close": "95.55",
                "5. adjusted close": "95.55",
                "6. volume": "12101",
                "7. dividend amount": "0.0000",
                "8. split coefficient": "1.0",
            },
        },
    },
}

mock_forex_data = {
    "USD": {
        "Meta Data": {
            "1. Information": "Forex Daily Prices (open, high, low, close)",
            "2. From Symbol": "USD",
            "3. To Symbol": "EUR",
            "4. Output Size": "Full size",
            "5. Last Refreshed": "2023-03-30 19:10:00",
            "6. Time Zone": "UTC",
        },
        "Time Series FX (Daily)": {
            "2023-03-30": {
                "1. open": "0.92190",
                "2. high": "0.92340",
                "3. low": "0.91520",
                "4. close": "0.91660",
            },
            "2023-03-29": {
                "1. open": "0.92190",
                "2. high": "0.92410",
                "3. low": "0.91970",
                "4. close": "0.92200",
            },
            "2023-03-28": {
                "1. open": "0.92580",
                "2. high": "0.92590",
                "3. low": "0.92140",
                "4. close": "0.92210",
            },
            "2023-03-27": {
                "1. open": "0.92840",
                "2. high": "0.93040",
                "3. low": "0.92530",
                "4. close": "0.92590",
            },
            "2023-03-24": {
                "1. open": "0.92290",
                "2. high": "0.93270",
                "3. low": "0.92230",
                "4. close": "0.92900",
            },
            "2023-03-23": {
                "1. open": "0.92060",
                "2. high": "0.92330",
                "3. low": "0.91480",
                "4. close": "0.92280",
            },
        },
    },
    "EUR": {
        "Meta Data": {
            "1. Information": "Forex Daily Prices (open, high, low, close)",
            "2. From Symbol": "EUR",
            "3. To Symbol": "EUR",
            "4. Output Size": "Full size",
            "5. Last Refreshed": "2023-03-30 19:05:00",
            "6. Time Zone": "UTC",
        },
        "Time Series FX (Daily)": {
            "2023-03-30": {
                "1. open": "1.00000",
                "2. high": "1.00000",
                "3. low": "1.00000",
                "4. close": "1.00000",
            },
            "2023-03-29": {
                "1. open": "1.00000",
                "2. high": "1.00000",
                "3. low": "1.00000",
                "4. close": "1.00000",
            },
            "2023-03-28": {
                "1. open": "1.00000",
                "2. high": "1.00000",
                "3. low": "1.00000",
                "4. close": "1.00000",
            },
            "2023-03-27": {
                "1. open": "1.00000",
                "2. high": "1.00000",
                "3. low": "1.00000",
                "4. close": "1.00000",
            },
            "2023-03-24": {
                "1. open": "1.00000",
                "2. high": "1.00000",
                "3. low": "1.00000",
                "4. close": "1.00000",
            },
            "2023-03-23": {
                "1. open": "1.00000",
                "2. high": "1.00000",
                "3. low": "1.00000",
                "4. close": "1.00000",
            },
            "2023-03-22": {
                "1. open": "1.00000",
                "2. high": "1.00000",
                "3. low": "1.00000",
                "4. close": "1.00000",
            },
        },
    },
}

mock_stocks_held = {
    "realized": [
        {
            "date": "2023-03-28",
            "symbol": "GOOGL",
            "cost_per_share_buy": 10.0,
            "cost_per_share_sell": 20.0,
            "buy_price": 50.0,
            "sell_price": 100,
            "average_buy_fx_rate": 0.929,
            "average_sell_fx_rate": 0.929,
            "quantity": 5,
            "transaction_cost": 1.0,
            "currency": "USD",
        },
        {
            "date": "2023-03-28",
            "symbol": "aapl",
            "cost_per_share_buy": 20.0,
            "cost_per_share_sell": 33.333333333333336,
            "buy_price": 60.0,
            "sell_price": 100,
            "average_buy_fx_rate": 0.929,
            "average_sell_fx_rate": 0.929,
            "quantity": 3,
            "transaction_cost": 1.0,
            "currency": "USD",
        },
        {
            "date": "2023-03-29",
            "symbol": "GOOGL",
            "cost_per_share_buy": 10.0,
            "cost_per_share_sell": 20.0,
            "buy_price": 100,
            "sell_price": 200,
            "average_buy_fx_rate": 0.929,
            "average_sell_fx_rate": 0.929,
            "quantity": 10,
            "transaction_cost": 1.5,
            "currency": "USD",
        },
        {
            "date": "2023-03-29",
            "symbol": "aapl",
            "cost_per_share_buy": 20.0,
            "cost_per_share_sell": 33.333333333333336,
            "buy_price": 60.0,
            "sell_price": 100,
            "average_buy_fx_rate": 0.929,
            "average_sell_fx_rate": 0.929,
            "quantity": 3,
            "transaction_cost": 1.0,
            "currency" "": "USD",
        },
        {
            "date": "2023-03-29",
            "symbol": "MSFT",
            "cost_per_share_buy": 125.0,
            "cost_per_share_sell": 270.0,
            "buy_price": 125.0,
            "sell_price": 270,
            "average_buy_fx_rate": 0.929,
            "average_sell_fx_rate": 0.929,
            "quantity": 1,
            "transaction_cost": 1.0,
            "currency": "USD",
        },
    ],
    "unrealized": [
        {
            "date": "2023-03-27",
            "symbol": "GOOGL",
            "cost_per_share": 10.0,
            "total_cost": 100,
            "average_fx_rate": 0.929,
            "quantity": 10,
            "transaction_cost": 0.5,
            "currency": "USD",
        },
        {
            "date": "2023-03-27",
            "symbol": "aapl",
            "cost_per_share": 20.0,
            "total_cost": 100,
            "average_fx_rate": 0.929,
            "quantity": 5,
            "transaction_cost": 0.5,
            "currency": "USD",
        },
        {
            "date": "2023-03-28",
            "symbol": "GOOGL",
            "cost_per_share": 10.0,
            "total_cost": 50.0,
            "average_fx_rate": 0.929,
            "quantity": 5,
            "transaction_cost": 0.0,
            "currency": "USD",
        },
        {
            "date": "2023-03-28",
            "symbol": "aapl",
            "cost_per_share": 20.0,
            "total_cost": 40.0,
            "average_fx_rate": 0.929,
            "quantity": 2,
            "transaction_cost": 0.0,
            "currency": "USD",
        },
        {
            "date": "2023-03-28",
            "symbol": "MSFT",
            "cost_per_share": 125.0,
            "total_cost": 250,
            "average_fx_rate": 0.929,
            "quantity": 2,
            "transaction_cost": 0.5,
            "currency": "USD",
        },
        {
            "date": "2023-03-28",
            "symbol": "AMD",
            "cost_per_share": 100.0,
            "total_cost": 100,
            "average_fx_rate": 0.929,
            "quantity": 1,
            "transaction_cost": 0.5,
            "currency": "USD",
        },
        {
            "date": "2023-03-29",
            "symbol": "aapl",
            "cost_per_share": 35.0,
            "total_cost": 140.0,
            "average_fx_rate": 0.929,
            "quantity": 4,
            "transaction_cost": 0.5,
            "currency": "USD",
        },
        {
            "date": "2023-03-29",
            "symbol": "MSFT",
            "cost_per_share": 125.0,
            "total_cost": 125.0,
            "average_fx_rate": 0.929,
            "quantity": 1,
            "transaction_cost": 0.0,
            "currency": "USD",
        },
        {
            "date": "2023-03-29",
            "symbol": "AMD",
            "cost_per_share": 100.0,
            "total_cost": 100,
            "average_fx_rate": 0.929,
            "quantity": 1,
            "transaction_cost": 0.5,
            "currency": "USD",
        },
        {
            "date": "2023-03-29",
            "symbol": "VWRL.AMS",
            "cost_per_share": 50.0,
            "total_cost": 100,
            "average_fx_rate": 1.0,
            "quantity": 2,
            "transaction_cost": 0.5,
            "currency": "EUR",
        },
    ],
}

mock_transactions = {
    "transactions": [
        {
            "symbol": "GOOGL",
            "date": "2023-03-25",
            "cost": 100,
            "quantity": 10,
            "transaction_type": "Buy",
            "transaction_cost": 0.5,
            "currency": "USD",
            "domain": "google.com",
            "userid": "2e43b4a359f8d5bb81550495b114e9e3",
            "id": "9a7b12ca-bd93-44f0-9e20-a061ce270f9b",
        },
        {
            "symbol": "aapl",
            "date": "2023-03-27",
            "cost": 100,
            "quantity": 5,
            "transaction_type": "Buy",
            "transaction_cost": 0.5,
            "currency": "USD",
            "domain": "apple.com",
            "userid": "2e43b4a359f8d5bb81550495b114e9e3",
            "id": "9a7bca-bd93-4430-9e20-a061ce270fdd",
        },
        {
            "symbol": "MSFT",
            "date": "2023-03-28",
            "cost": 250,
            "quantity": 2,
            "transaction_type": "Buy",
            "transaction_cost": 0.5,
            "currency": "USD",
            "domain": "microsoft.com",
            "userid": "2e43b4a359f8d5bb81550495b114e9e3",
            "id": "81364101-4055-4245-8f97-17d0820a7e70",
        },
        {
            "symbol": "AMD",
            "date": "2023-03-28",
            "cost": 100,
            "quantity": 1,
            "transaction_type": "Buy",
            "transaction_cost": 0.5,
            "currency": "USD",
            "domain": "amd.com",
            "userid": "2e43b4a359f8d5bb81550495b114e9e3",
            "id": "9a7b12ca-bd93-4430-9e20-a061ce270f9b",
        },
        {
            "symbol": "GOOGL",
            "date": "2023-03-28",
            "cost": 100,
            "quantity": 5,
            "transaction_type": "Sell",
            "transaction_cost": 0.5,
            "currency": "USD",
            "domain": "google.com",
            "userid": "2e43b4a359f8d5bb81550495b114e9e3",
            "id": "9a7b12ca-bd93-44z0-9e20-a061ce270f9b",
        },
        {
            "symbol": "aapl",
            "date": "2023-03-28",
            "cost": 100,
            "quantity": 3,
            "transaction_type": "Sell",
            "transaction_cost": 0.5,
            "currency": "USD",
            "domain": "apple.com",
            "userid": "2e43b4a359f8d5bb81550495b114e9e3",
            "id": "9a7b12ca-bd93-9e20-a061ce270fdd",
        },
        {
            "symbol": "MSFT",
            "date": "2023-03-29",
            "cost": 270,
            "quantity": 1,
            "transaction_type": "Sell",
            "transaction_cost": 0.5,
            "currency": "USD",
            "domain": "microsoft.com",
            "userid": "2e43b4a359f8d5bb81550495b114e9e3",
            "id": "fddc9b9a-9b9a-4b9a-9b9a-9b9a9b9a9b9a",
        },
        {
            "symbol": "GOOGL",
            "date": "2023-03-29",
            "cost": 100,
            "quantity": 5,
            "transaction_type": "Sell",
            "transaction_cost": 0.5,
            "currency": "USD",
            "domain": "google.com",
            "userid": "2e43b4a359f8d5bb81550495b114e9e3",
            "id": "9a7b12ca-bd93-443x-9e20-a061ce270f9b",
        },
        {
            "symbol": "aapl",
            "date": "2023-03-29",
            "cost": 100,
            "quantity": 2,
            "transaction_type": "Buy",
            "transaction_cost": 0.5,
            "currency": "USD",
            "domain": "apple.com",
            "userid": "2e43b4a359f8d5bb81550495b114e9e3",
            "id": "9a7b12ca-b3-4430-9e20-a061ce270fdd",
        },
        {
            "symbol": "VWRL.AMS",
            "date": "2023-03-29",
            "cost": 100,
            "quantity": 2,
            "transaction_type": "Buy",
            "transaction_cost": 0.5,
            "currency": "EUR",
            "domain": "vanguard.com",
            "userid": "2e43b4a359f8d5bb81550495b114e9e3",
            "id": "9a7b12ca-4430-9e20-a061ce270fdd",
        },
    ],
    "invested": [
        {
            "date": "2023-03-26",
            "amount": 1000,
            "transaction_type": "Deposit",
            "userid": "2e43b4a359f8d5bb81550495b114e9e3",
            "id": "b25aeb95-175c-48c3-96ef-39428fd16792",
        },
        {
            "date": "2023-03-27",
            "amount": 1000,
            "transaction_type": "Deposit",
            "userid": "Deposit",
            "id": "b25aeasdfasdf175c-48c3-96ef-39428fd16792",
        },
        {
            "date": "2023-03-28",
            "amount": 1000,
            "transaction_type": "Withdrawal",
            "userid": "2e43b4a359f8d5bb81550495b114e9e3",
            "id": "b25aeb95-175c-48c6ef-39428fd16792",
        },
    ],
    "daterange": ["2023-03-27", "2023-03-28", "2023-03-29"],
    "symbols": ["GOOGL", "aapl", "MSFT", "AMD", "VWRL.AMS"],
}

expected_result = [
    {
        "date": "2023-03-27",
        "symbol": "GOOGL",
        "currency": "USD",
        "fully_realized": False,
        "partial_realized": False,
        "realized": {
            "cost_per_share_buy": 0.0,
            "cost_per_share_sell": 0.0,
            "buy_price": 0.0,
            "sell_price": 0.0,
            "average_buy_fx_rate": 0.0,
            "average_sell_fx_rate": 0.0,
            "quantity": 0.0,
            "transaction_cost": 0.5,
            "dividend": 0.0,
            "total_dividends": 0.0,
            "value_change": 0.0,
            "total_pl": -0.5,
            "value_change_percentage": 0.0,
            "total_pl_percentage": -0.0005245005537886648,
        },
        "unrealized": {
            "cost_per_share": 10.0,
            "total_cost": 100,
            "average_fx_rate": 0.929,
            "quantity": 10,
            "open_value": 97.33379599999999,
            "high_value": 97.468704,
            "low_value": 94.83315992,
            "close_value": 95.328784,
            "total_value": 953.28784,
            "total_pl": 853.28784,
            "total_pl_percentage": 8.5328784,
        },
        "combined": {"total_pl": 852.78784, "total_pl_percentage": 8.527878399999999},
        "userid": "123",
    },
    {
        "date": "2023-03-27",
        "symbol": "aapl",
        "currency": "USD",
        "fully_realized": False,
        "partial_realized": False,
        "realized": {
            "cost_per_share_buy": 0.0,
            "cost_per_share_sell": 0.0,
            "buy_price": 0.0,
            "sell_price": 0.0,
            "average_buy_fx_rate": 0.0,
            "average_sell_fx_rate": 0.0,
            "quantity": 0.0,
            "transaction_cost": 0.5,
            "dividend": 0.0,
            "total_dividends": 0.0,
            "value_change": 0.0,
            "total_pl": -0.5,
            "value_change_percentage": 0.0,
            "total_pl_percentage": -0.0006790539138385973,
        },
        "unrealized": {
            "cost_per_share": 20.0,
            "total_cost": 100,
            "average_fx_rate": 0.929,
            "quantity": 5,
            "open_value": 148.808176,
            "high_value": 149.580408,
            "low_value": 146.882248,
            "close_value": 147.263712,
            "total_value": 736.3185599999999,
            "total_pl": 636.3185599999999,
            "total_pl_percentage": 6.3631855999999996,
        },
        "combined": {"total_pl": 635.8185599999999, "total_pl_percentage": 6.3581856},
        "userid": "123",
    },
    {
        "date": "2023-03-28",
        "symbol": "GOOGL",
        "currency": "USD",
        "fully_realized": False,
        "partial_realized": True,
        "realized": {
            "cost_per_share_buy": 10.0,
            "cost_per_share_sell": 20.0,
            "buy_price": 50.0,
            "sell_price": 100,
            "average_buy_fx_rate": 0.929,
            "average_sell_fx_rate": 0.929,
            "quantity": 5,
            "transaction_cost": 1.0,
            "dividend": 0.0,
            "total_dividends": 0.0,
            "value_change": 50.0,
            "total_pl": 49.0,
            "value_change_percentage": 1.0,
            "total_pl_percentage": 0.98,
        },
        "unrealized": {
            "cost_per_share": 10.0,
            "total_cost": 50.0,
            "average_fx_rate": 0.929,
            "quantity": 5,
            "open_value": 94.84919599999999,
            "high_value": 94.85845499999999,
            "low_value": 92.34926599999999,
            "close_value": 93.543677,
            "total_value": 467.718385,
            "total_pl": 417.718385,
            "total_pl_percentage": 8.354367700000001,
        },
        "combined": {"total_pl": 466.718385, "total_pl_percentage": 4.66718385},
        "userid": "123",
    },
    {
        "date": "2023-03-28",
        "symbol": "aapl",
        "currency": "USD",
        "fully_realized": False,
        "partial_realized": True,
        "realized": {
            "cost_per_share_buy": 20.0,
            "cost_per_share_sell": 33.333333333333336,
            "buy_price": 60.0,
            "sell_price": 100,
            "average_buy_fx_rate": 0.929,
            "average_sell_fx_rate": 0.929,
            "quantity": 3,
            "transaction_cost": 1.0,
            "dividend": 0.0,
            "total_dividends": 0.0,
            "value_change": 40.0,
            "total_pl": 39.0,
            "value_change_percentage": 0.6666666666666666,
            "total_pl_percentage": 0.65,
        },
        "unrealized": {
            "cost_per_share": 20.0,
            "total_cost": 40.0,
            "average_fx_rate": 0.929,
            "quantity": 2,
            "open_value": 146.264423,
            "high_value": 146.745891,
            "low_value": 144.42188199999998,
            "close_value": 145.968135,
            "total_value": 291.93627,
            "total_pl": 251.93626999999998,
            "total_pl_percentage": 6.29840675,
        },
        "combined": {"total_pl": 290.93627, "total_pl_percentage": 2.9093627},
        "userid": "123",
    },
    {
        "date": "2023-03-28",
        "symbol": "MSFT",
        "currency": "USD",
        "fully_realized": False,
        "partial_realized": False,
        "realized": {
            "cost_per_share_buy": 0.0,
            "cost_per_share_sell": 0.0,
            "buy_price": 0.0,
            "sell_price": 0.0,
            "average_buy_fx_rate": 0.0,
            "average_sell_fx_rate": 0.0,
            "quantity": 0.0,
            "transaction_cost": 0.5,
            "dividend": 0.0,
            "total_dividends": 0.0,
            "value_change": 0.0,
            "total_pl": -0.5,
            "value_change_percentage": 0.0,
            "total_pl_percentage": -0.0009810251797103728,
        },
        "unrealized": {
            "cost_per_share": 125.0,
            "total_cost": 250,
            "average_fx_rate": 0.929,
            "quantity": 2,
            "open_value": 255.353961,
            "high_value": 255.67802599999996,
            "low_value": 251.88655808999997,
            "close_value": 254.835457,
            "total_value": 509.670914,
            "total_pl": 259.670914,
            "total_pl_percentage": 1.038683656,
        },
        "combined": {"total_pl": 259.170914, "total_pl_percentage": 1.036683656},
        "userid": "123",
    },
    {
        "date": "2023-03-28",
        "symbol": "AMD",
        "currency": "USD",
        "fully_realized": False,
        "partial_realized": False,
        "realized": {
            "cost_per_share_buy": 0.0,
            "cost_per_share_sell": 0.0,
            "buy_price": 0.0,
            "sell_price": 0.0,
            "average_buy_fx_rate": 0.0,
            "average_sell_fx_rate": 0.0,
            "quantity": 0.0,
            "transaction_cost": 0.5,
            "dividend": 0.0,
            "total_dividends": 0.0,
            "value_change": 0.0,
            "total_pl": -0.5,
            "value_change_percentage": 0.0,
            "total_pl_percentage": -0.005710819801431598,
        },
        "unrealized": {
            "cost_per_share": 100.0,
            "total_cost": 100,
            "average_fx_rate": 0.929,
            "quantity": 1,
            "open_value": 89.59934299999999,
            "high_value": 89.75674599999999,
            "low_value": 85.988333,
            "close_value": 87.55310399999999,
            "total_value": 87.55310399999999,
            "total_pl": -12.44689600000001,
            "total_pl_percentage": -0.1244689600000001,
        },
        "combined": {
            "total_pl": -12.94689600000001,
            "total_pl_percentage": -0.1294689600000001,
        },
        "userid": "123",
    },
    {
        "date": "2023-03-29",
        "symbol": "GOOGL",
        "currency": "USD",
        "fully_realized": True,
        "partial_realized": False,
        "realized": {
            "cost_per_share_buy": 10.0,
            "cost_per_share_sell": 20.0,
            "buy_price": 100,
            "sell_price": 200,
            "average_buy_fx_rate": 0.929,
            "average_sell_fx_rate": 0.929,
            "quantity": 10,
            "transaction_cost": 1.5,
            "dividend": 0.0,
            "total_dividends": 0.0,
            "value_change": 100,
            "total_pl": 98.5,
            "value_change_percentage": 1.0,
            "total_pl_percentage": 0.985,
        },
        "unrealized": {
            "cost_per_share": 0.0,
            "total_cost": 0.0,
            "average_fx_rate": 0.0,
            "quantity": 0.0,
            "open_value": 94.516948,
            "high_value": 94.711009,
            "low_value": 93.010665,
            "close_value": 93.69449900000001,
            "total_value": 0.0,
            "total_pl": 0.0,
            "total_pl_percentage": 0.0,
        },
        "combined": {"total_pl": 98.5, "total_pl_percentage": 0.985},
        "userid": "123",
    },
    {
        "date": "2023-03-29",
        "symbol": "aapl",
        "currency": "USD",
        "fully_realized": False,
        "partial_realized": True,
        "realized": {
            "cost_per_share_buy": 20.0,
            "cost_per_share_sell": 33.333333333333336,
            "buy_price": 60.0,
            "sell_price": 100,
            "average_buy_fx_rate": 0.929,
            "average_sell_fx_rate": 0.929,
            "quantity": 3,
            "transaction_cost": 1.5,
            "dividend": 0.0,
            "total_dividends": 0.0,
            "value_change": 40.0,
            "total_pl": 38.5,
            "value_change_percentage": 0.6666666666666666,
            "total_pl_percentage": 0.6416666666666667,
        },
        "unrealized": {
            "cost_per_share": 35.0,
            "total_cost": 140.0,
            "average_fx_rate": 0.929,
            "quantity": 4,
            "open_value": 147.273817,
            "high_value": 148.82630500000002,
            "low_value": 147.255335,
            "close_value": 148.56755700000002,
            "total_value": 594.2702280000001,
            "total_pl": 454.2702280000001,
            "total_pl_percentage": 3.2447873428571437,
        },
        "combined": {
            "total_pl": 492.7702280000001,
            "total_pl_percentage": 2.4638511400000005,
        },
        "userid": "123",
    },
    {
        "date": "2023-03-29",
        "symbol": "MSFT",
        "currency": "USD",
        "fully_realized": False,
        "partial_realized": True,
        "realized": {
            "cost_per_share_buy": 125.0,
            "cost_per_share_sell": 270.0,
            "buy_price": 125.0,
            "sell_price": 270,
            "average_buy_fx_rate": 0.929,
            "average_sell_fx_rate": 0.929,
            "quantity": 1,
            "transaction_cost": 1.0,
            "dividend": 0.0,
            "total_dividends": 0.0,
            "value_change": 145.0,
            "total_pl": 144.0,
            "value_change_percentage": 1.16,
            "total_pl_percentage": 1.152,
        },
        "unrealized": {
            "cost_per_share": 125.0,
            "total_cost": 125.0,
            "average_fx_rate": 0.929,
            "quantity": 1,
            "open_value": 257.78693599999997,
            "high_value": 259.80128917999997,
            "low_value": 257.278681,
            "close_value": 259.219291,
            "total_value": 259.219291,
            "total_pl": 134.219291,
            "total_pl_percentage": 1.073754328,
        },
        "combined": {"total_pl": 278.219291, "total_pl_percentage": 1.112877164},
        "userid": "123",
    },
    {
        "date": "2023-03-29",
        "symbol": "AMD",
        "currency": "USD",
        "fully_realized": False,
        "partial_realized": False,
        "realized": {
            "cost_per_share_buy": 0.0,
            "cost_per_share_sell": 0.0,
            "buy_price": 0.0,
            "sell_price": 0.0,
            "average_buy_fx_rate": 0.0,
            "average_sell_fx_rate": 0.0,
            "quantity": 0.0,
            "transaction_cost": 0.5,
            "dividend": 0.0,
            "total_dividends": 0.0,
            "value_change": 0.0,
            "total_pl": -0.5,
            "value_change_percentage": 0.0,
            "total_pl_percentage": -0.005630835509341561,
        },
        "unrealized": {
            "cost_per_share": 100.0,
            "total_cost": 100,
            "average_fx_rate": 0.929,
            "quantity": 1,
            "open_value": 88.77828699999999,
            "high_value": 89.554531,
            "low_value": 87.66936700000001,
            "close_value": 88.79676900000001,
            "total_value": 88.79676900000001,
            "total_pl": -11.203230999999988,
            "total_pl_percentage": -0.11203230999999989,
        },
        "combined": {
            "total_pl": -11.703230999999988,
            "total_pl_percentage": -0.11703230999999988,
        },
        "userid": "123",
    },
    {
        "date": "2023-03-29",
        "symbol": "VWRL.AMS",
        "currency": "EUR",
        "fully_realized": False,
        "partial_realized": False,
        "realized": {
            "cost_per_share_buy": 0.0,
            "cost_per_share_sell": 0.0,
            "buy_price": 0.0,
            "sell_price": 0.0,
            "average_buy_fx_rate": 0.0,
            "average_sell_fx_rate": 0.0,
            "quantity": 0.0,
            "transaction_cost": 0.5,
            "dividend": 0.0,
            "total_dividends": 0.0,
            "value_change": 0.0,
            "total_pl": -0.5,
            "value_change_percentage": 0.0,
            "total_pl_percentage": -0.0026047093144405085,
        },
        "unrealized": {
            "cost_per_share": 50.0,
            "total_cost": 100,
            "average_fx_rate": 1.0,
            "quantity": 2,
            "open_value": 95.77,
            "high_value": 96.0,
            "low_value": 95.59,
            "close_value": 95.98,
            "total_value": 191.96,
            "total_pl": 91.96000000000001,
            "total_pl_percentage": 0.9196000000000001,
        },
        "combined": {
            "total_pl": 91.46000000000001,
            "total_pl_percentage": 0.9146000000000001,
        },
        "userid": "123",
    },
]


def test_all():
    """Test with all input"""

    result = main(
        [
            mock_stocks_held,
            mock_stock_data,
            mock_forex_data,
            mock_transactions,
            "all",
            "123",
        ]
    )

    assert result[0] is None
    assert result[1] is None
    for d in result[2]:
        d.pop("id")
    assert result[2] == expected_result
